<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>å·¥ç¨‹ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ï¼ˆV7.5ï¼šç®¡ç†é …ç›®ã®éè¡¨ç¤ºãƒˆã‚°ãƒ«ä¿®æ­£ï¼‰</title>
<style>
  :root{ --ink:#222; --muted:#666; --line:#ddd; --bg:#f7f7f9;
         --run:#2ecc71; --down:#e74c3c; --change:#f1c40f; --setup:#9b59b6; --break:#95a5a6; --focus:#1f6feb; }
  *{box-sizing:border-box}
  body{font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Hiragino Sans","Noto Sans JP",sans-serif;margin:0;background:var(--bg);color:var(--ink)}
  header{position:sticky;top:0;background:#fff;border-bottom:1px solid var(--line);padding:12px 16px;z-index:10;display:flex;align-items:center;gap:12px}
  h1{margin:0;font-size:20px}
  .spacer{flex:1}
  .adminBadge{font-size:12px;color:#333;background:#ffe79a;border:1px solid #f0c455;border-radius:6px;padding:2px 8px;display:none}
  main{padding:16px;display:flex;flex-direction:column;gap:16px}
  .card{background:#fff;border:1px solid var(--line);border-radius:12px;padding:12px}
  .row{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
  input,select,button{font-size:14px}
  .big{display:flex;align-items:center;justify-content:center;height:120px;font-size:28px;border-radius:18px;border:2px solid var(--run);background:#e8f7ef;color:#0a6;width:100%;cursor:grab}
  .big.running{background:#ffe9e9;border-color:var(--down);color:#c0392b}
  table{width:100%;border-collapse:collapse}
  th,td{border:1px solid var(--line);padding:6px 8px;font-size:13px}
  th{background:#fafafa;text-align:left}
  .kpi{display:grid;grid-template-columns: repeat(3, minmax(160px,1fr)); gap:8px}
  .chip{background:#fafafa;border:1px solid var(--line);border-radius:8px;padding:8px}
  .legend{display:flex;gap:12px;flex-wrap:wrap;margin-top:8px}
  .chip2{display:flex;align-items:center;gap:6px}
  .chip2 i{width:14px;height:14px;display:inline-block;border-radius:4px}
  /* æ¨ªã‚¬ãƒ³ãƒˆ */
  .timeline{border:1px solid var(--line);border-radius:12px;padding:8px;background:#fff}
  .scale{position:relative;border-top:1px solid var(--line);height:28px;margin:8px 0}
  .tick{position:absolute;top:0;height:28px;border-left:1px solid var(--line)}
  .tick span{position:absolute;top:0;left:2px;font-size:12px;color:#999}
  .lane{position:relative;height:36px;margin:10px 0;background:linear-gradient(90deg, rgba(0,0,0,0.03) 0 1px, transparent 1px) }
  .bar{position:absolute;height:24px;border-radius:6px;display:flex;align-items:center;justify-content:center;color:#fff;font-size:12px;padding:0 6px;white-space:nowrap;cursor:grab}
  .bar.dragging{cursor:grabbing}
  .handle{position:absolute;top:0;width:8px;height:100%;cursor:ew-resize}
  .handle.left{left:0;border-top-left-radius:6px;border-bottom-left-radius:6px}
  .handle.right{right:0;border-top-right-radius:6px;border-bottom-right-radius:6px}
  .ghost{position:absolute;height:24px;border-radius:6px;border:2px dashed var(--focus);background:transparent;pointer-events:none}
  .tooltip{position:fixed;z-index:9999;background:#333;color:#fff;font-size:12px;padding:4px 8px;border-radius:6px;box-shadow:0 2px 6px rgba(0,0,0,0.2)}
  .tick.highlight span{color:#000;font-weight:600}
  .controls{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
  .adminline{display:flex;gap:12px;align-items:center;flex-wrap:wrap;margin-top:8px}
  .switch{display:inline-flex;align-items:center;gap:6px}
  /* ç®¡ç†ãƒ‘ãƒãƒ«ã®ç¢ºå®Ÿãªéš ã— */
  .hiddenAdmin{display:none !important}
</style>
</head>
<body>
<header>
  <h1>å·¥ç¨‹ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ï¼ˆV7.5ï¼‰</h1>
  <span id="adminBadge" class="adminBadge">ç®¡ç†è€…ãƒ¢ãƒ¼ãƒ‰ ON</span>
  <div class="spacer"></div>
  <button id="toggleAdmin">ç®¡ç†è€…ãƒ¢ãƒ¼ãƒ‰</button>
</header>
<main>
  <section class="card">
    <h2>è¨­å®š</h2>
    <div class="row">
      <label>æ—¥ä»˜ <input type="date" id="day"></label>
      <label>å‹¤å‹™é–‹å§‹ <input type="time" id="workStart" value="08:15"></label>
      <label>å‹¤å‹™çµ‚äº† <input type="time" id="workEnd" value="17:00"></label>
      <label>è£½å“ <select id="product"><option>2E</option><option>2J</option><option>2L</option><option>2LH</option></select></label>
    </div>
    <p class="row" style="margin-top:8px"><strong>å›ºå®šä¼‘æ†©</strong>ï¼š10:00ã€œ5åˆ† / 11:45ã€œ45åˆ† / 15:00ã€œ10åˆ† ã¯è‡ªå‹•æŒ¿å…¥ï¼ˆä¼‘æ†©ã¾ãŸãè¨±å¯ï¼‰ã€‚</p>
  </section>

  <section class="card">
    <h2>ã‚ªãƒšãƒ¬ãƒ¼ã‚¿ãƒ¼ãƒ¢ãƒ¼ãƒ‰</h2>
    <button id="toggleRun" class="big">ç¨¼åƒ é–‹å§‹</button>
    <p style="margin-top:8px;color:var(--muted)">ä¸­å¤®ãƒœã‚¿ãƒ³ã ã‘ã§è¨˜éŒ²ï¼ˆé–‹å§‹â†’åœæ­¢ï¼‰ã€‚ä»–ã®æ“ä½œã¯ä¸è¦ã€‚</p>
  </section>

  <section class="card">
    <h2>ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«è¡¨</h2>
    <div style="max-height:320px;overflow:auto">
      <table id="sched">
        <thead><tr><th>æ—¥ä»˜</th><th>é–‹å§‹</th><th>çµ‚äº†</th><th>åŒºåˆ†</th><th>è£½å“</th><th>æ‰€è¦åˆ†</th><th>ãƒ¡ãƒ¢</th></tr></thead>
        <tbody></tbody>
      </table>
    </div>
    <div class="kpi" style="margin-top:8px">
      <div class="chip"><strong>ç¨¼åƒåˆè¨ˆ</strong><div id="sumRun">-</div></div>
      <div class="chip"><strong>ä¼‘æ†©åˆè¨ˆ</strong><div id="sumBreak">-</div></div>
      <div class="chip"><strong>ç¨¼åƒç‡</strong><div id="availability">-</div></div>
    </div>
  </section>

  <section class="card timeline">
    <h2>ã‚¬ãƒ³ãƒˆãƒ»ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ï¼ˆ1æ™‚é–“ç›®ç››ã‚Šï¼‰</h2>
    <div class="legend">
      <div class="chip2"><i style="background:var(--run)"></i>ç¨¼åƒï¼ˆç·‘ï¼‰</div>
      <div class="chip2"><i style="background:var(--down)"></i>åœæ­¢ï¼ˆèµ¤ï¼‰</div>
      <div class="chip2"><i style="background:var(--change)"></i>Lotåˆ‡æ›¿ï¼ˆé»„ï¼‰</div>
      <div class="chip2"><i style="background:var(--setup)"></i>ç«‹ã¡ä¸Šã’/ç«‹ã¡ä¸‹ã’ï¼ˆç´«ï¼‰</div>
      <div class="chip2"><i style="background:var(--break)"></i>ä¼‘æ†©ï¼ˆç°ï¼‰</div>
    </div>
    <div class="scale" id="scale"></div>
    <div id="lanes"></div>
    <div class="controls" style="margin-top:8px">
      <button id="downloadCsv">ğŸ“¥ CSV</button>
      <button id="print">ğŸ–¨ï¸ å°åˆ·</button>
      <button id="undo" title="1æ®µéšæˆ»ã™">â†¶ å…ƒã«æˆ»ã™</button>
    </div>
  </section>

  <!-- ç®¡ç†è€…ãƒ‘ãƒãƒ«ï¼ˆãƒˆã‚°ãƒ«ã§å®Œå…¨éè¡¨ç¤ºå¯èƒ½ï¼‰ -->
  <section class="card hiddenAdmin" id="adminPanel">
    <h2>ç®¡ç†è€…ãƒ¢ãƒ¼ãƒ‰</h2>
    <div class="adminline">
      <div class="switch"><input type="checkbox" id="lockBreaks"> <label for="lockBreaks">ä¼‘æ†©ãƒãƒ¼ã®ãƒ‰ãƒ©ãƒƒã‚°ï¼ãƒªã‚µã‚¤ã‚ºã‚’ç¦æ­¢</label></div>
      <small class="muted">â€»ONã§ä¼‘æ†©ã‚¤ãƒ™ãƒ³ãƒˆã¯è§¦ã‚Œãªããªã‚Šã¾ã™ã€‚OFFã§é€šå¸¸æ“ä½œã«æˆ»ã‚Šã¾ã™ã€‚</small>
    </div>
    <div style="margin-top:8px">
      <h3>ã‚ªãƒªã‚¸ãƒŠãƒ«ã‚¿ã‚¤ãƒ—ã®è¿½åŠ </h3>
      <div class="row">
        <label>åç§° <input type="text" id="newTypeName" placeholder="ä¾‹ï¼šåˆƒäº¤æ›ï¼ãƒšãƒ¼ã‚¹ãƒˆè£œå……ï¼å¸Œé‡ˆ"></label>
        <label>æ‰€è¦ï¼ˆåˆ†ï¼‰<input type="number" id="newTypeMin" value="20"></label>
        <label>è‰² <input type="color" id="newTypeColor" value="#1abc9c"></label>
        <button id="createType">ï¼‹ã‚¿ã‚¤ãƒ—ä½œæˆ</button>
      </div>
      <div id="typeList" style="margin-top:8px"></div>
    </div>
  </section>
</main>

<script>
  const fixedColors={ 'ç¨¼åƒ':'var(--run)','åœæ­¢':'var(--down)','Lotåˆ‡æ›¿':'var(--change)','ç«‹ã¡ä¸Šã’':'var(--setup)','ç«‹ã¡ä¸‹ã’':'var(--setup)','ä¼‘æ†©':'var(--break)'};
  const SNAP_MIN = 5;
  function toMinutes(t){ const [h,m]=t.split(':').map(Number); return h*60+m; }
  function mm(x){ return String(Math.floor(x/60)).padStart(2,'0')+':'+String(x%60).padStart(2,'0'); }
  function todayStr(){ const d=new Date(); const z=new Date(d.getTime()-d.getTimezoneOffset()*60000); return z.toISOString().slice(0,10); }
  function snap(min){ return Math.round(min / SNAP_MIN) * SNAP_MIN; }

  const dayEl=document.getElementById('day');
  const wsEl=document.getElementById('workStart');
  const weEl=document.getElementById('workEnd');
  const prodEl=document.getElementById('product');
  const toggleRun=document.getElementById('toggleRun');
  const toggleAdmin=document.getElementById('toggleAdmin');
  const adminPanel=document.getElementById('adminPanel');
  const adminBadge=document.getElementById('adminBadge');
  const lockBreaksEl=document.getElementById('lockBreaks');
  const typeList=document.getElementById('typeList');

  let running=null; const events=[]; let customTypes = JSON.parse(localStorage.getItem('v7_5_types')||'[]'); let undoStack=[];
  let lockBreaks = JSON.parse(localStorage.getItem('v7_5_lockBreaks')||'false'); lockBreaksEl.checked = !!lockBreaks;
  let adminVisible = JSON.parse(localStorage.getItem('v7_5_adminVisible')||'false');

  function clampToWork(min){ const s=toMinutes(wsEl.value), e=toMinutes(weEl.value); return Math.max(s, Math.min(e, min)); }
  function getColor(type){ const v = fixedColors[type]; if(v){ return getComputedStyle(document.documentElement).getPropertyValue(v)||v; } const ct = customTypes.find(t=>t.name===type); return ct? ct.color : '#888'; }
  function addEvent(date, start, end, type, product, memo='', color){ const dur=Math.max(0,end-start); events.push({date,start,end,type,product,memo,dur,color:color||getColor(type)}); render(); save(); }

  function insertFixedBreaks(){ const s=toMinutes(wsEl.value), e=toMinutes(weEl.value); const breaks=[ ['10:00',5], ['11:45',45], ['15:00',10] ]; breaks.forEach(([hhmm, dur])=>{ const bs=toMinutes(hhmm), be=bs+dur; if(be>s && bs<e){ addEvent(dayEl.value, Math.max(bs,s), Math.min(be,e), 'ä¼‘æ†©', prodEl.value, `ä¼‘æ†© ${hhmm} ${dur}åˆ†`, getColor('ä¼‘æ†©')); } }); }

  // Admin toggleï¼ˆå®Œå…¨éè¡¨ç¤ºï¼‹ãƒãƒƒã‚¸è¡¨ç¤ºã€çŠ¶æ…‹ã‚’æ°¸ç¶šåŒ–ï¼‰
  function applyAdminVisible(){ if(adminVisible){ adminPanel.classList.remove('hiddenAdmin'); adminBadge.style.display='inline-block'; } else { adminPanel.classList.add('hiddenAdmin'); adminBadge.style.display='none'; } }
  toggleAdmin.addEventListener('click',()=>{ adminVisible = !adminVisible; localStorage.setItem('v7_5_adminVisible', JSON.stringify(adminVisible)); applyAdminVisible(); });

  // Operator toggle
  toggleRun.addEventListener('click',()=>{ if(!prodEl.value){ alert('è£½å“ã‚’é¸æŠã—ã¦ãã ã•ã„'); return; } const now=new Date(); const cur=clampToWork(now.getHours()*60+now.getMinutes()); if(!running){ running={start:cur}; toggleRun.textContent='ç¨¼åƒ åœæ­¢'; toggleRun.classList.add('running'); } else { addEvent(dayEl.value, running.start, cur, 'ç¨¼åƒ', prodEl.value); running=null; toggleRun.textContent='ç¨¼åƒ é–‹å§‹'; toggleRun.classList.remove('running'); } });

  // Break lock
  lockBreaksEl.addEventListener('change',()=>{ lockBreaks = lockBreaksEl.checked; localStorage.setItem('v7_5_lockBreaks', JSON.stringify(lockBreaks)); render(); });

  // Custom type create
  document.getElementById('createType').addEventListener('click',()=>{ const name=(document.getElementById('newTypeName').value||'').trim(); const min=Number(document.getElementById('newTypeMin').value||0); const color=document.getElementById('newTypeColor').value||'#888'; if(!name){ alert('åç§°ã‚’å…¥åŠ›'); return; } if(min<=0){ alert('æ‰€è¦åˆ†ã¯1ä»¥ä¸Š'); return; } customTypes.push({name,min,color}); localStorage.setItem('v7_5_types', JSON.stringify(customTypes)); renderTypes(); document.getElementById('newTypeName').value=''; });
  function renderTypes(){ typeList.innerHTML=''; customTypes.forEach((t)=>{ const btn=document.createElement('button'); btn.textContent=`ï¼‹${t.name}ï¼ˆ${t.min}åˆ†ï¼‰`; btn.addEventListener('click',()=>{ const now=new Date(); const cur=clampToWork(now.getHours()*60+now.getMinutes()); addEvent(dayEl.value, cur, cur+t.min, t.name, prodEl.value, '', t.color); }); typeList.appendChild(btn); }); }

  // Table & KPI & Timeline
  function render(){ events.sort((a,b)=>a.start-b.start); const tb=document.querySelector('#sched tbody'); tb.innerHTML=''; events.forEach((ev)=>{ const tr=document.createElement('tr'); tr.innerHTML=`<td>${ev.date}</td><td>${mm(ev.start)}</td><td>${mm(ev.end)}</td><td>${ev.type}</td><td>${ev.product}</td><td>${ev.dur}</td><td>${ev.memo||''}</td>`; tb.appendChild(tr); });
    const span=Math.max(1,toMinutes(weEl.value)-toMinutes(wsEl.value)); const run=events.filter(e=>e.type==='ç¨¼åƒ').reduce((a,b)=>a+b.dur,0); const brk=events.filter(e=>e.type==='ä¼‘æ†©').reduce((a,b)=>a+b.dur,0); document.getElementById('sumRun').textContent=`${run} åˆ†`; document.getElementById('sumBreak').textContent=`${brk} åˆ†`; document.getElementById('availability').textContent=`${(run/span*100).toFixed(1)} %ï¼ˆå‹¤å‹™${span}åˆ†ï¼‰`;
    drawTimeline(); }

  // Timeline drawing + drag/resizeï¼ˆ1æ™‚é–“ç›®ç››ã‚Š / 5åˆ†ã‚¹ãƒŠãƒƒãƒ—ï¼‰
  let pixelPerMin = 2; let ghost = null; let tooltip = null; let dragState = null;
  function createTooltip(){ if(!tooltip){ tooltip=document.createElement('div'); tooltip.className='tooltip'; document.body.appendChild(tooltip);} }
  function showTooltip(s,e){ createTooltip(); tooltip.style.display='block'; tooltip.textContent=`${mm(s)}â€“${mm(e)} / ${e-s}åˆ†`; }
  function moveTooltip(x,y){ if(tooltip){ tooltip.style.left=(x+12)+'px'; tooltip.style.top=(y+12)+'px'; } }
  function hideTooltip(){ if(tooltip){ tooltip.style.display='none'; } }

  function drawTimeline(){ const s=toMinutes(wsEl.value), e=toMinutes(weEl.value), span=Math.max(1,e-s); const $scale=document.getElementById('scale'); const $lanes=document.getElementById('lanes'); $scale.innerHTML=''; $lanes.innerHTML=''; const lane=document.createElement('div'); lane.className='lane'; $lanes.appendChild(lane);
    const laneWidth = lane.clientWidth || 800; pixelPerMin = laneWidth / span;
    for(let t=s; t<=e; t+=60){ const x=((t-s)/span)*100; const tick=document.createElement('div'); tick.className='tick'; tick.style.left=x+'%'; const label=document.createElement('span'); label.textContent=mm(t); tick.appendChild(label); $scale.appendChild(tick); }
    events.forEach((ev,idx)=>{ const left=((ev.start-s)/span)*100, right=((ev.end-s)/span)*100; const bar=document.createElement('div'); bar.className='bar'; bar.style.left=left+'%'; bar.style.width=Math.max(0,right-left)+'%'; bar.style.background=ev.color||getColor(ev.type); bar.textContent=ev.type; bar.title=`${mm(ev.start)}-${mm(ev.end)} ${ev.type}ï½œ${ev.product}`;
      const isLocked = lockBreaks && ev.type==='ä¼‘æ†©';
      if(!isLocked){ const hL=document.createElement('div'); hL.className='handle left'; const hR=document.createElement('div'); hR.className='handle right'; bar.appendChild(hL); bar.appendChild(hR);
        bar.addEventListener('mousedown',(e)=>{ const rect=bar.getBoundingClientRect(); const pad=8; const x=e.clientX; let mode='move'; if(x<=rect.left+pad) mode='resizeLeft'; else if(x>=rect.right-pad) mode='resizeRight'; dragState={mode, start0:ev.start, end0:ev.end, x0:e.clientX, y0:e.clientY, idx:idx, sBase:s, span:span}; bar.classList.add('dragging'); showTooltip(ev.start, ev.end); moveTooltip(e.clientX,e.clientY); }); }
      else { bar.style.cursor='default'; }
      lane.appendChild(bar);
    });
  }

  document.addEventListener('mousemove',(e)=>{ if(!dragState) return; const dx=e.clientX - dragState.x0; const deltaMin = Math.round(dx / pixelPerMin); let start=dragState.start0, end=dragState.end0; if(dragState.mode==='move'){ start = clampToWork(snap(dragState.start0 + deltaMin)); end = clampToWork(snap(dragState.end0   + deltaMin)); } else if(dragState.mode==='resizeLeft'){ start = clampToWork(snap(dragState.start0 + deltaMin)); if(end-start<1) start=end-1; } else if(dragState.mode==='resizeRight'){ end   = clampToWork(snap(dragState.end0   + deltaMin)); if(end-start<1) end=start+1; }
    const s=toMinutes(wsEl.value), e2=toMinutes(weEl.value), span=Math.max(1,e2-s); const lane=document.querySelector('.lane'); if(!ghost){ ghost=document.createElement('div'); ghost.className='ghost'; lane.appendChild(ghost);} const left=((start-s)/span)*100, right=((end-s)/span)*100; ghost.style.left=left+'%'; ghost.style.width=Math.max(0,right-left)+'%'; ghost.style.top='6px'; showTooltip(start,end); moveTooltip(e.clientX,e.clientY); highlightNearestTick(start,end);
  });

  document.addEventListener('mouseup',()=>{ if(!dragState) return; const idx=dragState.idx; const lane=document.querySelector('.lane'); if(ghost){ undoStack.push(JSON.stringify(events)); const s=toMinutes(wsEl.value), span=Math.max(1,toMinutes(weEl.value)-s); const ghostLeftPct=parseFloat(ghost.style.left); const ghostWidthPct=parseFloat(ghost.style.width); const newStart = Math.round(s + (ghostLeftPct/100)*span); const newEnd = Math.round(s + ((ghostLeftPct+ghostWidthPct)/100)*span); events[idx].start = newStart; events[idx].end = newEnd; events[idx].dur = Math.max(0,newEnd-newStart); lane.removeChild(ghost); ghost=null; }
    hideTooltip(); dragState=null; render(); save(); });

  function highlightNearestTick(start){ const ticks=[...document.querySelectorAll('.tick')]; ticks.forEach(t=>t.classList.remove('highlight')); const s=toMinutes(wsEl.value), span=Math.max(1,toMinutes(weEl.value)-s); const startPct=((start-s)/span)*100; let best=null, bestDiff=1e9; ticks.forEach(t=>{ const left=parseFloat(t.style.left); const diff=Math.abs(left-startPct); if(diff<bestDiff){ best=t; bestDiff=diff; } }); if(best) best.classList.add('highlight'); }

  // CSV + Print + Undo
  document.getElementById('downloadCsv').addEventListener('click',()=>{ const header='date,start,end,type,product,duration_min,memo\n'; const rows=events.map(ev=>`${ev.date},${mm(ev.start)},${mm(ev.end)},${ev.type},${ev.product},${ev.dur},${ev.memo||''}`).join('\n'); const blob=new Blob([header+rows],{type:'text/csv'}); const url=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download='engine_sim_v7_5.csv'; a.click(); URL.revokeObjectURL(url); });
  document.getElementById('print').addEventListener('click',()=>window.print());
  document.getElementById('undo').addEventListener('click',()=>{ if(undoStack.length){ const last=undoStack.pop(); try{ const prev=JSON.parse(last); events.splice(0,events.length,...prev); render(); save(); }catch(e){} } });

  // Persist
  function save(){ localStorage.setItem('v7_5_events', JSON.stringify(events)); localStorage.setItem('v7_5_day', dayEl.value); localStorage.setItem('v7_5_ws', wsEl.value); localStorage.setItem('v7_5_we', weEl.value); localStorage.setItem('v7_5_prod', prodEl.value); localStorage.setItem('v7_5_types', JSON.stringify(customTypes)); localStorage.setItem('v7_5_lockBreaks', JSON.stringify(lockBreaks)); localStorage.setItem('v7_5_adminVisible', JSON.stringify(adminVisible)); }
  function restore(){ dayEl.value = localStorage.getItem('v7_5_day') || todayStr(); const s=localStorage.getItem('v7_5_ws'); if(s) wsEl.value=s; const e=localStorage.getItem('v7_5_we'); if(e) weEl.value=e; const p=localStorage.getItem('v7_5_prod'); if(p) prodEl.value=p; customTypes = JSON.parse(localStorage.getItem('v7_5_types')||'[]'); lockBreaks = JSON.parse(localStorage.getItem('v7_5_lockBreaks')||'false'); lockBreaksEl.checked = !!lockBreaks; adminVisible = JSON.parse(localStorage.getItem('v7_5_adminVisible')||'false'); renderTypes(); applyAdminVisible(); render(); }

  // Init
  restore(); (function(){ const hasBreaks=events.some(ev=>ev.type==='ä¼‘æ†©'); if(!hasBreaks) insertFixedBreaks(); })();
</script>
</body>
</html>