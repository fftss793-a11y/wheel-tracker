<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å·¥ç¨‹èƒ½åŠ›ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ V15 (NV73S)</title>
    <style>
        :root {
            --primary: #0f172a;
            --primary-light: #f1f5f9;
            --accent: #2563eb;
            --bg: #e2e8f0;
            --card-bg: #ffffff;
            --text-main: #334155;
            --text-sub: #64748b;
            --border: #cbd5e1;
            --success: #16a34a;
            --warning: #d97706;
            --danger: #dc2626;
        }

        body {
            font-family: 'Segoe UI', Meiryo, sans-serif;
            background-color: var(--bg);
            color: var(--text-main);
            margin: 0;
            padding: 40px;
            display: flex;
            justify-content: flex-start;
            min-height: 100vh;
        }

        .container {
            width: 100%;
            display: grid;
            grid-template-columns: 450px 1fr;
            gap: 30px;
            align-items: start;
        }

        .card {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        .card-header {
            font-size: 1.1rem;
            font-weight: bold;
            color: var(--primary);
            border-bottom: 2px solid var(--primary-light);
            padding-bottom: 10px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .tab-container {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .tab-btn {
            flex: 1;
            padding: 10px;
            border: none;
            background: #e2e8f0;
            color: var(--text-sub);
            font-weight: bold;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .tab-btn.active {
            background: var(--accent);
            color: white;
            box-shadow: 0 4px 6px -1px rgba(37, 99, 235, 0.3);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-label {
            display: block;
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: 6px;
            color: var(--text-main);
        }

        .input-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 10px;
        }

        input[type="number"],
        input[type="time"],
        select {
            padding: 8px 12px;
            border: 1px solid var(--border);
            border-radius: 6px;
            font-size: 1rem;
            width: 100px;
            text-align: right;
        }

        input[type="time"] {
            width: 110px;
            text-align: center;
        }

        select {
            width: 100%;
            text-align: left;
            cursor: pointer;
        }

        input:focus,
        select:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .unit {
            color: var(--text-sub);
            font-size: 0.9rem;
            width: 40px;
        }

        .btn-clear {
            background-color: #ef4444;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 0.85rem;
            cursor: pointer;
        }

        .btn-clear:hover {
            background-color: #dc2626;
        }

        .lot-input-grid {
            display: grid;
            grid-template-columns: 30px 1fr 80px 1fr 30px;
            gap: 8px;
            align-items: center;
            margin-bottom: 8px;
            padding-bottom: 8px;
            border-bottom: 1px dashed #f1f5f9;
        }

        .lot-input-grid.mixed-mode {
            grid-template-columns: 30px 80px 60px 1fr 30px;
        }

        .lot-no {
            font-weight: bold;
            color: var(--text-sub);
            text-align: center;
        }

        .lot-select {
            width: 100% !important;
            text-align: center !important;
            padding: 6px !important;
        }

        .lot-qty {
            width: 100% !important;
        }

        .tc-row {
            grid-column: 1 / -1;
            display: flex;
            align-items: center;
            gap: 8px;
            background: #fff7ed;
            padding: 4px 8px;
            border-radius: 4px;
            margin-bottom: 4px;
            font-size: 0.85rem;
            color: #c2410c;
        }

        .loss-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9rem;
            margin-bottom: 10px;
        }

        .loss-table th {
            text-align: left;
            padding: 8px 4px;
            color: var(--text-sub);
            font-weight: 600;
            border-bottom: 1px solid var(--border);
        }

        .loss-table td {
            padding: 8px 4px;
            border-bottom: 1px solid #f1f5f9;
            vertical-align: middle;
        }

        .loss-name {
            font-weight: 500;
        }

        .loss-time {
            text-align: right;
            color: var(--text-sub);
        }

        .loss-check {
            width: 24px;
            text-align: center;
        }

        .loss-input {
            width: 60px !important;
            padding: 4px !important;
            font-size: 0.9rem !important;
        }

        .breakdown-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9rem;
            margin-top: 10px;
        }

        .breakdown-table th {
            text-align: left;
            padding: 8px;
            background: #f8fafc;
            color: var(--text-sub);
            font-weight: 600;
            border-bottom: 2px solid var(--border);
        }

        .breakdown-table td {
            padding: 8px;
            border-bottom: 1px solid #f1f5f9;
        }

        .breakdown-table tr:last-child td {
            border-bottom: none;
            font-weight: bold;
            background: #f8fafc;
        }

        .result-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }

        .kpi-card {
            background: var(--primary-light);
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            border: 1px solid var(--border);
        }

        .kpi-label {
            font-size: 0.9rem;
            color: var(--text-sub);
            margin-bottom: 8px;
        }

        .kpi-value {
            font-size: 2rem;
            font-weight: 800;
            color: var(--primary);
        }

        .kpi-unit {
            font-size: 1rem;
            font-weight: normal;
            color: var(--text-sub);
        }

        .main-kpi {
            background: #eff6ff;
            border-color: #bfdbfe;
        }

        .main-kpi .kpi-value {
            color: var(--accent);
            font-size: 3rem;
        }

        .timeline-container {
            margin-top: 20px;
            overflow-x: hidden;
            padding-bottom: 20px;
        }

        .timeline-scale {
            display: flex;
            border-bottom: 1px solid #cbd5e1;
            margin-bottom: 5px;
            position: relative;
            height: 20px;
        }

        .scale-hour {
            font-size: 0.8rem;
            color: var(--text-sub);
            border-left: 1px solid #e2e8f0;
            padding-left: 4px;
        }

        .timeline-bars {
            position: relative;
            height: 60px;
            background: #f8fafc;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
        }

        .tl-event {
            position: absolute;
            height: 40px;
            top: 10px;
            border-radius: 4px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            cursor: pointer;
        }

        .tl-event:hover {
            z-index: 10;
            transform: scaleY(1.2);
            filter: brightness(1.1);
        }

        .schedule-list {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.85rem;
            margin-top: 20px;
        }

        .schedule-list th {
            text-align: left;
            padding: 6px;
            background: #f1f5f9;
            color: var(--text-sub);
            border-bottom: 1px solid var(--border);
        }

        .schedule-list td {
            padding: 6px;
            border-bottom: 1px solid #f1f5f9;
        }

        .schedule-list tr:hover {
            background: #f8fafc;
        }

        .bg-break {
            background-color: #94a3b8;
        }

        .bg-setup {
            background-color: #1e40af;
        }

        .bg-loss {
            background-color: #f59e0b;
        }

        .bg-run {
            background-color: #22c55e;
        }

        .bg-switch {
            background-color: #eab308;
        }

        .bg-complete {
            background-color: #16a34a;
        }

        .legend {
            display: flex;
            justify-content: center;
            gap: 15px;
            font-size: 0.85rem;
            color: var(--text-sub);
            flex-wrap: wrap;
            margin-top: 10px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .dot {
            width: 12px;
            height: 12px;
            border-radius: 4px;
        }

        .spec-table {
            width: 100%;
            font-size: 0.85rem;
            color: var(--text-sub);
            margin-top: 10px;
            border-collapse: collapse;
        }

        .spec-table td {
            padding: 4px 0;
            border-bottom: 1px solid #f1f5f9;
        }

        .spec-table td:last-child {
            text-align: right;
            font-weight: bold;
            color: var(--text-main);
        }

        .explanation-box {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
            font-size: 0.85rem;
            color: var(--text-sub);
        }

        .explanation-title {
            font-weight: bold;
            color: var(--text-main);
            margin-bottom: 5px;
            display: block;
        }

        /* Print Preview Mode */
        .print-preview-mode .sidebar {
            display: none !important;
        }

        .print-preview-mode .container {
            display: block;
            max-width: 100%;
        }

        .print-preview-mode .main-content {
            width: 100%;
        }

        .print-preview-mode .card {
            box-shadow: none;
            border: 1px solid #e2e8f0;
            page-break-inside: avoid;
        }

        .print-preview-mode .result-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .print-preview-mode .kpi-card {
            box-shadow: none;
            border: 1px solid #e2e8f0;
        }

        .print-preview-bar {
            display: none;
            background: #1e40af;
            color: white;
            padding: 15px 30px;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            justify-content: space-between;
            align-items: center;
        }

        .print-preview-mode .print-preview-bar {
            display: flex;
        }

        .print-preview-mode body {
            padding-top: 70px;
        }

        .print-btn {
            background: white;
            color: #1e40af;
            border: none;
            padding: 8px 20px;
            border-radius: 6px;
            font-weight: bold;
            cursor: pointer;
            margin-left: 10px;
        }

        .print-btn:hover {
            background: #f1f5f9;
        }

        .preview-toggle-btn {
            background: #10b981;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            font-weight: bold;
            cursor: pointer;
            margin-left: 10px;
        }

        .preview-toggle-btn:hover {
            background: #059669;
        }

        @media print {
            .print-preview-bar {
                display: none !important;
            }

            body {
                padding: 0 !important;
            }

            .sidebar {
                display: none !important;
            }

            .container {
                display: block;
            }

            .main-content {
                width: 100%;
            }

            .card {
                box-shadow: none;
                border: 1px solid #e2e8f0;
                page-break-inside: avoid;
            }
        }
    </style>
</head>

<body>
    <!-- Print Preview Bar -->
    <div class="print-preview-bar" id="printPreviewBar">
        <span style="font-size: 1.1rem;">ğŸ“„ å°åˆ·ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ - ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³çµæœ</span>
        <div>
            <button class="print-btn" onclick="window.print()">ğŸ–¨ï¸ å°åˆ·</button>
            <button class="print-btn" onclick="togglePrintPreview()">âœ• é–‰ã˜ã‚‹</button>
        </div>
    </div>

    <div class="container">
        <div class="sidebar">
            <h1>å·¥ç¨‹èƒ½åŠ›ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ V15</h1>
            <div class="tab-container">
                <button class="tab-btn active" onclick="switchTab('2E')">2E (å›ºå®š)</button>
                <button class="tab-btn" onclick="switchTab('Mixed')">ä»–ã‚µã‚¤ã‚º (æ··è¼‰)</button>
            </div>

            <div class="card" style="background: #f0f9ff; padding: 15px; margin-bottom: 15px;">
                <div style="font-size: 0.9rem; font-weight: bold; color: #0369a1; margin-bottom: 8px;">è©•ä¾¡ãƒ¢ãƒ¼ãƒ‰</div>
                <div class="tab-container">
                    <button class="tab-btn" id="planModeBtn" onclick="switchEvalMode('plan')"
                        style="font-size: 0.85rem;">è¨ˆç”»ãƒ¢ãƒ¼ãƒ‰</button>
                    <button class="tab-btn active" id="evalModeBtn" onclick="switchEvalMode('eval')"
                        style="font-size: 0.85rem;">å®Ÿç¸¾è©•ä¾¡</button>
                </div>
                <div style="font-size: 0.75rem; color: #64748b; margin-top: 6px;">
                    <span id="evalModeDesc">å®Ÿæ¸¬æœ€å¤§é€Ÿåº¦ã§æ”¹å–„ä½™åœ°ã‚’è©•ä¾¡</span>
                </div>
            </div>

            <div class="card">
                <div class="card-header">1. è£½å“ãƒ»ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«<button class="btn-clear" onclick="clearInputs()">ã‚¯ãƒªã‚¢</button>
                </div>
                <div class="input-group">
                    <label class="input-label">ç¨¼åƒæ™‚é–“</label>
                    <div class="input-row">
                        <input type="time" id="startTime" value="08:15" onchange="calculate()">
                        <span style="font-size: 0.85rem; color: var(--text-sub);">ï½ <input type="time" id="endTimeInput"
                                value="17:00" onchange="calculate()"> (å®šæ™‚)</span>
                    </div>
                </div>
                <div id="tab-2E" class="tab-content active">
                    <div class="input-group">
                        <label class="input-label">ã‚µã‚¤ã‚º: 2E (å›ºå®š)</label>
                        <div style="font-size: 0.85rem; color: var(--text-sub); margin-top: 4px;">85å€‹/åˆ†, 2000å€‹/å·»</div>
                    </div>
                    <div id="lotInputs2E"></div>
                </div>
                <div id="tab-Mixed" class="tab-content">
                    <div class="input-group">
                        <label class="input-label">æœã‚¤ãƒå“ç¨®åˆ‡æ›¿ (ç«‹ã¡ä¸Šã’å¾Œ)</label>
                        <div class="tc-row" style="background: #f1f5f9; color: var(--text-main);">
                            <input type="checkbox" id="morningTC" onchange="calculate()">
                            <span>å®Ÿæ–½ã™ã‚‹ (15åˆ†)</span>
                        </div>
                    </div>
                    <div id="lotInputsMixed"></div>
                </div>
                <div class="input-group" style="margin-top: 20px;">
                    <div style="text-align: right; font-size: 0.9rem;">åˆè¨ˆ: <span id="totalQty"
                            style="font-weight: bold;">0</span> å€‹ (<span id="totalLots">0</span> Lot)</div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">2. éç¨¼åƒæ™‚é–“ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼</div>
                <div class="input-group">
                    <label class="input-label">ç·ç¨¼åƒæ™‚é–“ (è‡ªå‹•è¨ˆç®—)</label>
                    <div class="input-row">
                        <input type="number" id="totalWorkTime" value="525" readonly
                            style="background: #f1f5f9; color: var(--text-sub);">
                        <span class="unit">åˆ†</span>
                    </div>
                </div>
                <table class="loss-table">
                    <thead>
                        <tr>
                            <th>æœ‰åŠ¹</th>
                            <th>é …ç›®</th>
                            <th style="text-align: right;">æ™‚é–“(åˆ†)</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td colspan="3"
                                style="background: #f1f5f9; font-size: 0.8rem; font-weight: bold; padding: 4px 8px;">
                                å›ºå®šçš„éç¨¼åƒæ™‚é–“</td>
                        </tr>
                        <tr>
                            <td class="loss-check"><input type="checkbox" checked disabled></td>
                            <td class="loss-name">è¨ˆç”»ä¼‘æ†© (10:00, 11:45, 15:00)</td>
                            <td class="loss-time">60</td>
                        </tr>
                        <tr>
                            <td class="loss-check"><input type="checkbox" id="checkSetup" checked
                                    onchange="calculate()"></td>
                            <td class="loss-name">è¨­å‚™ç«‹ã¡ä¸Šã’<div style="font-size: 0.75rem; color: var(--danger);">
                                    â€»ç¨¼åƒã§ãã‚‹æ‰‹å‰ã¾ã§ã®æ™‚é–“</div>
                            </td>
                            <td class="loss-time"><input type="number" id="setupTime" value="45" class="loss-input"
                                    oninput="calculate()"></td>
                        </tr>
                        <tr>
                            <td class="loss-check"><input type="checkbox" id="checkShutdown" checked
                                    onchange="calculate()"></td>
                            <td class="loss-name">è¨­å‚™ç«‹ã¡ä¸‹ã’</td>
                            <td class="loss-time"><input type="number" id="shutdownTime" value="10" class="loss-input"
                                    oninput="calculate()"></td>
                        </tr>
                        <tr>
                            <td class="loss-check"><input type="checkbox" id="checkTopTape" onchange="calculate()"></td>
                            <td class="loss-name">ãƒˆãƒƒãƒ—ãƒ†ãƒ¼ãƒ—äº¤æ›</td>
                            <td class="loss-time">15</td>
                        </tr>
                        <tr>
                            <td class="loss-check"><input type="checkbox" id="checkCarrierTape" onchange="calculate()">
                            </td>
                            <td class="loss-name">ã‚­ãƒ£ãƒªã‚¢ãƒ†ãƒ¼ãƒ—äº¤æ›</td>
                            <td class="loss-time">15</td>
                        </tr>
                        <tr>
                            <td colspan="3"
                                style="background: #f1f5f9; font-size: 0.8rem; font-weight: bold; padding: 4px 8px;">
                                å¤‰å‹•çš„éç¨¼åƒæ™‚é–“ (æ®µå–ã‚Š)</td>
                        </tr>
                        <tr>
                            <td class="loss-check"><input type="checkbox" checked disabled></td>
                            <td class="loss-name">ãƒªãƒ¼ãƒ«äº¤æ› (<span id="reelSwitchCount">0</span>å›)<div
                                    style="font-size: 0.75rem; color: var(--text-sub);">è‡ªå‹•è¨ˆç®—: 1åˆ†/å›</div>
                            </td>
                            <td class="loss-time" id="reelSwitchTime">0</td>
                        </tr>
                        <tr>
                            <td class="loss-check"><input type="checkbox" checked disabled></td>
                            <td class="loss-name">Lotåˆ‡æ›¿ (<span id="lotSwitchCount">0</span>å›)<div
                                    style="font-size: 0.75rem; color: var(--text-sub);">è‡ªå‹•è¨ˆç®—: <input type="number"
                                        id="lotSwitchUnitTime" value="10" class="loss-count-input"
                                        oninput="calculate()">åˆ†/å›</div>
                            </td>
                            <td class="loss-time" id="lotSwitchTimeDisp">0</td>
                        </tr>
                        <tr class="type-change-row">
                            <td class="loss-check"><input type="checkbox" checked disabled></td>
                            <td class="loss-name">å“ç¨®åˆ‡æ›¿ (æ®µæ›¿ãˆ)<div style="font-size: 0.75rem; color: var(--text-sub);">
                                    <span id="typeChangeCount">0</span> å› Ã— 15åˆ†
                                </div>
                            </td>
                            <td class="loss-time" id="typeChangeTimeDisp">0</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div class="main-content">
            <div class="result-grid">
                <div class="kpi-card main-kpi">
                    <div class="kpi-label">ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«åˆ¤å®š</div>
                    <div class="kpi-value" id="judgeResult">---</div>
                    <div style="font-size: 0.9rem; color: var(--text-sub); margin-top: 5px;"><span
                            id="judgeDetail">---</span></div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-label">çµ‚äº†äºˆå®šæ™‚åˆ»</div>
                    <div class="kpi-value" style="font-size: 2.5rem;"><span id="resultEndTime">---</span></div>
                    <div style="font-size: 0.8rem; color: var(--text-sub);">(ç·æ‰€è¦ <span id="resultTotalTime">---</span>
                        åˆ†)</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-label">ç´”è£½é€ æ™‚é–“</div>
                    <div class="kpi-value"><span id="resultRunTime">---</span><span class="kpi-unit"> åˆ†</span></div>
                    <div style="font-size: 0.8rem; color: var(--text-sub);">(åˆ‡æ›¿ãƒ»æ®µå–é™¤ã)</div>
                </div>
            </div>

            <div class="card chart-container">
                <div class="card-header">1æ—¥ã®ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ (å®Ÿç¸¾ãƒ™ãƒ¼ã‚¹)<button class="preview-toggle-btn"
                        onclick="togglePrintPreview()">ğŸ“„ å°åˆ·ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</button></div>
                <div class="timeline-container">
                    <div class="timeline-scale" id="timelineScale"></div>
                    <div class="timeline-bars" id="timelineBars"></div>
                </div>
                <div class="legend">
                    <div class="legend-item">
                        <div class="dot bg-break"></div>ä¼‘æ†©
                    </div>
                    <div class="legend-item">
                        <div class="dot bg-setup"></div>ç«‹ã¡ä¸Šã’/ä¸‹ã’
                    </div>
                    <div class="legend-item">
                        <div class="dot bg-loss"></div>å“ç¨®åˆ‡æ›¿/éƒ¨å“
                    </div>
                    <div class="legend-item">
                        <div class="dot bg-run"></div>è£½é€ (Run)
                    </div>
                    <div class="legend-item">
                        <div class="dot bg-switch"></div>Lotåˆ‡æ›¿
                    </div>
                </div>
                <div style="margin-top: 20px;">
                    <div style="font-weight: bold; color: var(--text-sub); margin-bottom: 5px;">ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«è©³ç´°</div>
                    <table class="schedule-list">
                        <thead>
                            <tr>
                                <th style="width: 80px;">é–‹å§‹</th>
                                <th style="width: 80px;">çµ‚äº†</th>
                                <th>å†…å®¹</th>
                                <th style="text-align: right;">æ™‚é–“</th>
                            </tr>
                        </thead>
                        <tbody id="scheduleListBody"></tbody>
                    </table>
                </div>
            </div>

            <div class="card" style="display: grid; grid-template-columns: 2fr 1fr; gap: 20px;">
                <div>
                    <div class="card-header">éç¨¼åƒæ™‚é–“ å†…è¨³ãƒ»å‰²åˆ</div>
                    <table class="breakdown-table">
                        <thead>
                            <tr>
                                <th>åˆ†é¡</th>
                                <th>é …ç›®</th>
                                <th style="text-align: right;">æ™‚é–“</th>
                                <th style="text-align: right;">å¯¾ç¨¼åƒ(%)</th>
                                <th style="text-align: right;">å¯¾ãƒ­ã‚¹(%)</th>
                            </tr>
                        </thead>
                        <tbody id="breakdownBody"></tbody>
                    </table>
                </div>
                <div class="explanation-box">
                    <span class="explanation-title">ğŸ’¡ å‰²åˆã®è¦‹æ–¹</span>
                    <p style="margin-bottom: 10px;"><strong>å¯¾ç¨¼åƒ
                            (%)</strong><br>1æ—¥ã®ç·ç¨¼åƒæ™‚é–“ï¼ˆä¾‹:540åˆ†ï¼‰ã«å¯¾ã—ã¦ã€ãã®ãƒ­ã‚¹ãŒä½•ï¼…ã‚’å ã‚ã¦ã„ã‚‹ã‹ã€‚<br><span style="font-size: 0.8rem;">â†’
                            å…¨ä½“ã®ç”Ÿç”£æ€§ã¸ã®å½±éŸ¿åº¦ã‚’ç¤ºã—ã¾ã™ã€‚</span></p>
                    <p><strong>å¯¾ãƒ­ã‚¹ (%)</strong><br>ç™ºç”Ÿã—ãŸéç¨¼åƒæ™‚é–“ã®åˆè¨ˆã«å¯¾ã—ã¦ã€ãã®é …ç›®ãŒä½•ï¼…ã‚’å ã‚ã¦ã„ã‚‹ã‹ã€‚<br><span
                            style="font-size: 0.8rem;">â†’ æ”¹å–„ã™ã¹ãã‚¿ãƒ¼ã‚²ãƒƒãƒˆï¼ˆãƒœãƒˆãƒ«ãƒãƒƒã‚¯ï¼‰ã®ç‰¹å®šã«å½¹ç«‹ã¡ã¾ã™ã€‚</span></p>
                </div>
            </div>

            <div class="card">
                <div class="card-header">è¨ˆç®—è©³ç´°</div>
                <table class="spec-table" style="font-size: 1rem;">
                    <tr>
                        <td>ãƒ¢ãƒ¼ãƒ‰</td>
                        <td id="detailMode">---</td>
                    </tr>
                    <tr>
                        <td>ç·è£½é€ æ•°</td>
                        <td id="detailTotalQty">--- å€‹</td>
                    </tr>
                    <tr>
                        <td>éç¨¼åƒæ™‚é–“åˆè¨ˆ</td>
                        <td id="detailLoss">--- åˆ†</td>
                    </tr>
                    <tr>
                        <td>æ™‚é–“å½“ãŸã‚Šç”Ÿç”£æ•° (PPH)</td>
                        <td id="detailPPH">--- å€‹/h</td>
                    </tr>
                    <tr style="background: #f0fdf4;">
                        <td>è¨­å‚™èƒ½åŠ›
                            <div style="font-size: 0.75rem; color: var(--text-sub);">ğŸ“‹ è¨­å‚™ã®ã‚¹ãƒšãƒƒã‚¯å€¤ï¼ˆç†è«–æœ€å¤§ï¼‰</div>
                        </td>
                        <td id="detailSpecPPM">--- å€‹/åˆ†</td>
                    </tr>
                    <tr style="background: #eff6ff;">
                        <td>å®ŸåŠ¹PPM
                            <div style="font-size: 0.75rem; color: var(--text-sub);">ğŸ“Š å®Ÿéš›ã®ç”Ÿç”£æ€§ï¼ˆãƒ­ã‚¹è¾¼ã¿ï¼‰</div>
                        </td>
                        <td id="detailEffectivePPM">--- å€‹/åˆ†</td>
                    </tr>
                    <tr style="background: #fef3c7;">
                        <td>è¨­å‚™ç¨¼åƒåŠ¹ç‡
                            <div style="font-size: 0.75rem; color: var(--text-sub);">âš¡ è¨­å‚™èƒ½åŠ›ã‚’ã©ã‚Œã ã‘æ´»ã‹ã›ã¦ã„ã‚‹ã‹</div>
                        </td>
                        <td id="detailEfficiency">--- %</td>
                    </tr>
                    <tr>
                        <td>å¯å‹•ç‡ (Availability)</td>
                        <td id="detailAvailability">--- %</td>
                    </tr>
                </table>
                <div class="explanation-box" style="margin-top: 15px;">
                    <span class="explanation-title">ğŸ’¡ PPMã®è¦‹æ–¹</span>
                    <p style="margin-bottom: 8px;"><strong>è¨­å‚™èƒ½åŠ›</strong>: è¨­å‚™ã«è¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹1åˆ†ã‚ãŸã‚Šã®æœ€å¤§ç”Ÿç”£æ•°ã§ã™ã€‚</p>
                    <p style="margin-bottom: 8px;"><strong>å®ŸåŠ¹PPM</strong>: ä¼‘æ†©ãƒ»æ®µå–ã‚Šãƒ»åˆ‡æ›¿ã‚’å«ã‚ãŸã€Œå®Ÿéš›ã«1åˆ†ã§ä½•å€‹ä½œã‚ŒãŸã‹ã€ã§ã™ã€‚</p>
                    <p><strong>è¨­å‚™ç¨¼åƒåŠ¹ç‡</strong>: å®ŸåŠ¹PPM Ã· è¨­å‚™èƒ½åŠ› Ã— 100ã€‚<br><span style="font-size: 0.8rem;">â†’
                            100%ã«è¿‘ã„ã»ã©è¨­å‚™ã‚’ãƒ•ãƒ«æ´»ç”¨ã§ãã¦ã„ã¾ã™ã€‚ä½ã„å ´åˆã¯ãƒ­ã‚¹å‰Šæ¸›ã®ä½™åœ°ãŒã‚ã‚Šã¾ã™ã€‚</span></p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // è¨ˆç”»ãƒ¢ãƒ¼ãƒ‰ç”¨ï¼ˆä¿å®ˆçš„ï¼‰
        const SPECS_PLAN = {
            '2E': { speed: 85, step: 2000, reel: 2000 },
            '2J': { speed: 70, step: 1000, reel: 1000 },
            '2L': { speed: 60, step: 1000, reel: 1000 },
            '2LH': { speed: 60, step: 1000, reel: 1000 }
        };

        // å®Ÿç¸¾è©•ä¾¡ãƒ¢ãƒ¼ãƒ‰ç”¨ï¼ˆå®Ÿæ¸¬æœ€å¤§ï¼‰
        const SPECS_EVAL = {
            '2E': { speed: 95, step: 2000, reel: 2000 },
            '2J': { speed: 80, step: 1000, reel: 1000 },
            '2L': { speed: 70, step: 1000, reel: 1000 },
            '2LH': { speed: 70, step: 1000, reel: 1000 }
        };

        const BREAKS = [
            { start: 600, duration: 5, name: "ä¼‘æ†©" },
            { start: 705, duration: 45, name: "æ˜¼ä¼‘æ†©" },
            { start: 900, duration: 10, name: "ä¼‘æ†©" }
        ];

        let currentMode = '2E';
        let currentEvalMode = 'eval'; // 'plan' or 'eval'
        let SPECS = SPECS_EVAL; // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯å®Ÿç¸¾è©•ä¾¡ãƒ¢ãƒ¼ãƒ‰

        function switchEvalMode(mode) {
            currentEvalMode = mode;
            SPECS = (mode === 'plan') ? SPECS_PLAN : SPECS_EVAL;

            // ãƒœã‚¿ãƒ³ã®activeçŠ¶æ…‹ã‚’åˆ‡ã‚Šæ›¿ãˆ
            document.getElementById('planModeBtn').classList.toggle('active', mode === 'plan');
            document.getElementById('evalModeBtn').classList.toggle('active', mode === 'eval');

            // èª¬æ˜æ–‡ã‚’æ›´æ–°
            const desc = mode === 'plan'
                ? 'ä¿å®ˆçš„ãªé€Ÿåº¦ã§è¨ˆç”»ã‚’ç«‹ã¦ã‚‹'
                : 'å®Ÿæ¸¬æœ€å¤§é€Ÿåº¦ã§æ”¹å–„ä½™åœ°ã‚’è©•ä¾¡';
            document.getElementById('evalModeDesc').textContent = desc;

            // å†è¨ˆç®—
            calculate();
        }

        function init() { initLotInputs2E(); initLotInputsMixed(); switchTab('2E'); }

        function switchTab(mode) {
            currentMode = mode;
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            const btns = document.getElementsByClassName('tab-btn');
            for (let b of btns) {
                if (b.textContent.includes(mode) || (mode === 'Mixed' && b.textContent.includes('ä»–'))) b.classList.add('active');
            }
            document.getElementById(`tab-${mode}`).classList.add('active');
            calculate();
        }

        function initLotInputs2E() {
            const container = document.getElementById('lotInputs2E');
            container.innerHTML = `<div style="display: flex; justify-content: space-between; font-size: 0.85rem; color: var(--text-sub); margin-bottom: 4px; padding-right: 30px;"><span style="margin-left: 10px;">No.</span><span style="margin-left: 30px;">Lotæ•°</span><span style="margin-right: 40px;">æŒ‡ç¤ºæ•°(1Lot)</span></div>`;
            for (let i = 1; i <= 5; i++) {
                const div = document.createElement('div');
                div.className = 'lot-input-grid';
                let options = '';
                for (let j = 1; j <= 10; j++) options += `<option value="${j}">${j}</option>`;
                div.innerHTML = `<span class="lot-no">${i}</span><div style="text-align: center; color: var(--text-sub); font-size: 0.9rem;">2E</div><select id="lotCount2E_${i}" class="lot-select" onchange="calculate()"><option value="0">-</option>${options}</select><select id="lotQty2E_${i}" class="lot-select" onchange="calculate()"><option value="0">-</option><option value="2000">2,000</option><option value="4000">4,000</option><option value="6000">6,000</option><option value="8000">8,000</option><option value="10000">10,000</option><option value="12000">12,000</option><option value="14000">14,000</option><option value="16000">16,000</option></select><span class="unit">å€‹</span>`;
                container.appendChild(div);
            }
        }

        function initLotInputsMixed() {
            const container = document.getElementById('lotInputsMixed');
            container.innerHTML = '';
            for (let i = 1; i <= 5; i++) {
                const div = document.createElement('div');
                div.className = 'lot-input-grid mixed-mode';
                div.style.display = 'grid';
                div.style.gap = '8px';
                let sizeOptions = '';
                ['2J', '2L', '2LH'].forEach(s => sizeOptions += `<option value="${s}">${s}</option>`);
                let countOptions = '';
                for (let j = 1; j <= 10; j++) countOptions += `<option value="${j}">${j}</option>`;
                div.innerHTML = `<div class="tc-row"><input type="checkbox" id="tcMixed_${i}" onchange="calculate()"><span>ã“ã®Lotã®å‰ã«å“ç¨®åˆ‡æ›¿ (15åˆ†)</span></div><span class="lot-no">${i}</span><select id="sizeMixed_${i}" class="lot-select" onchange="updateStepMixed(${i}); calculate();">${sizeOptions}</select><select id="lotCountMixed_${i}" class="lot-select" onchange="calculate()"><option value="0">-</option>${countOptions}</select><input type="number" id="lotQtyMixed_${i}" class="lot-qty" value="0" min="0" step="1000" oninput="calculate()"><span class="unit">å€‹</span>`;
                container.appendChild(div);
            }
        }

        function updateStepMixed(idx) { document.getElementById(`lotQtyMixed_${idx}`).step = SPECS[document.getElementById(`sizeMixed_${idx}`).value].step; }

        function clearInputs() {
            for (let i = 1; i <= 5; i++) { document.getElementById(`lotCount2E_${i}`).value = "0"; document.getElementById(`lotQty2E_${i}`).value = "0"; }
            document.getElementById('morningTC').checked = false;
            for (let i = 1; i <= 5; i++) { document.getElementById(`tcMixed_${i}`).checked = false; document.getElementById(`lotCountMixed_${i}`).value = "0"; document.getElementById(`lotQtyMixed_${i}`).value = "0"; document.getElementById(`sizeMixed_${i}`).value = "2J"; }
            calculate();
        }

        function calculate() {
            const startTimeStr = document.getElementById('startTime').value;
            const [sh, sm] = startTimeStr.split(':').map(Number);
            const startTimeMin = sh * 60 + sm;
            const totalWorkTime = parseFloat(document.getElementById('totalWorkTime').value) || 0;

            let events = [];
            let currentTime = startTimeMin;
            let totalQty = 0, totalLots = 0, totalReelSwitchTime = 0, totalLotSwitchTime = 0, totalTypeChangeTime = 0, totalRunTime = 0, typeChangeCount = 0;

            const addEvent = (type, name, duration, colorClass) => {
                if (duration <= 0) return;
                events.push({ type, name, duration, start: currentTime, color: colorClass });
                currentTime += duration;
            };

            if (document.getElementById('checkSetup').checked) addEvent('Fixed', 'ç«‹ã¡ä¸Šã’', parseFloat(document.getElementById('setupTime').value) || 0, 'bg-setup');
            if (document.getElementById('checkTopTape').checked) addEvent('Fixed', 'ãƒˆãƒƒãƒ—ãƒ†ãƒ¼ãƒ—äº¤æ›', 15, 'bg-loss');
            if (document.getElementById('checkCarrierTape').checked) addEvent('Fixed', 'ã‚­ãƒ£ãƒªã‚¢ãƒ†ãƒ¼ãƒ—äº¤æ›', 15, 'bg-loss');
            if (currentMode === 'Mixed' && document.getElementById('morningTC').checked) { addEvent('Variable', 'å“ç¨®åˆ‡æ›¿', 15, 'bg-loss'); totalTypeChangeTime += 15; typeChangeCount++; }

            const lotSwitchUnitTime = parseFloat(document.getElementById('lotSwitchUnitTime').value) || 0;

            for (let i = 1; i <= 5; i++) {
                let count, qty, size, tcChecked;
                if (currentMode === '2E') { count = parseInt(document.getElementById(`lotCount2E_${i}`).value) || 0; qty = parseFloat(document.getElementById(`lotQty2E_${i}`).value) || 0; size = '2E'; tcChecked = false; }
                else { count = parseInt(document.getElementById(`lotCountMixed_${i}`).value) || 0; qty = parseFloat(document.getElementById(`lotQtyMixed_${i}`).value) || 0; size = document.getElementById(`sizeMixed_${i}`).value; tcChecked = document.getElementById(`tcMixed_${i}`).checked; }

                if (count > 0 && qty > 0) {
                    if (tcChecked) { addEvent('Variable', 'å“ç¨®åˆ‡æ›¿', 15, 'bg-loss'); totalTypeChangeTime += 15; typeChangeCount++; }
                    const spec = SPECS[size];
                    for (let lotNum = 1; lotNum <= count; lotNum++) {
                        const singleLotQty = qty;
                        const singleLotRunTime = singleLotQty / spec.speed;
                        const singleReelCount = Math.ceil(singleLotQty / spec.reel);
                        const singleReelSwitches = Math.max(0, singleReelCount - 1);
                        const singleReelTime = singleReelSwitches * 1;
                        addEvent('Run', `è£½é€ (${size}) Lot${lotNum} - ${singleLotQty}å€‹`, singleLotRunTime + singleReelTime, 'bg-run');
                        addEvent('Milestone', `âœ“ Lot${lotNum} å®Œäº†`, 0, 'bg-complete');
                        if (lotNum < count && lotSwitchUnitTime > 0) {
                            addEvent('Variable', 'Lotåˆ‡æ›¿', lotSwitchUnitTime, 'bg-switch');
                            totalLotSwitchTime += lotSwitchUnitTime;
                        }
                        totalQty += singleLotQty;
                        totalRunTime += singleLotRunTime;
                        totalReelSwitchTime += singleReelTime;
                    }
                    totalLots += count;
                    // Add Lot switch after this row (for transition to next row)
                    if (lotSwitchUnitTime > 0) {
                        addEvent('Variable', 'Lotåˆ‡æ›¿', lotSwitchUnitTime, 'bg-switch');
                        totalLotSwitchTime += lotSwitchUnitTime;
                    }
                }
            }

            // Remove the last unnecessary Lot switch (before shutdown)
            if (events.length > 0 && events[events.length - 1].name === 'Lotåˆ‡æ›¿') {
                const lastEvent = events.pop();
                currentTime -= lastEvent.duration;
                totalLotSwitchTime -= lastEvent.duration;
            }

            if (document.getElementById('checkShutdown').checked) addEvent('Fixed', 'ç«‹ã¡ä¸‹ã’', parseFloat(document.getElementById('shutdownTime').value) || 0, 'bg-setup');

            let finalEvents = [];
            let cursor = startTimeMin;
            document.getElementById('reelSwitchCount').textContent = Math.round(totalReelSwitchTime / 2);
            document.getElementById('reelSwitchTime').textContent = totalReelSwitchTime;
            document.getElementById('lotSwitchCount').textContent = totalLots;
            document.getElementById('lotSwitchTimeDisp').textContent = totalLotSwitchTime;
            document.getElementById('typeChangeCount').textContent = typeChangeCount;
            document.getElementById('typeChangeTimeDisp').textContent = totalTypeChangeTime;

            const sortedBreaks = BREAKS.sort((a, b) => a.start - b.start);
            events.forEach(evt => {
                let remainingDuration = evt.duration;
                while (remainingDuration > 0) {
                    let nextBreak = sortedBreaks.find(b => b.start >= cursor && b.start < cursor + remainingDuration);
                    let immediateBreak = sortedBreaks.find(b => b.start === cursor);
                    if (immediateBreak) { finalEvents.push({ name: immediateBreak.name, duration: immediateBreak.duration, start: cursor, color: 'bg-break' }); cursor += immediateBreak.duration; continue; }
                    if (nextBreak) { let runTime = nextBreak.start - cursor; if (runTime > 0) { finalEvents.push({ name: evt.name, duration: runTime, start: cursor, color: evt.color }); cursor += runTime; remainingDuration -= runTime; } }
                    else { finalEvents.push({ name: evt.name, duration: remainingDuration, start: cursor, color: evt.color }); cursor += remainingDuration; remainingDuration = 0; }
                }
            });

            const totalRequiredTime = cursor - startTimeMin;
            const endTimeMin = cursor;
            const endH = Math.floor(endTimeMin / 60) % 24;
            const endM = Math.floor(endTimeMin % 60);
            document.getElementById('resultEndTime').textContent = `${String(endH).padStart(2, '0')}:${String(endM).padStart(2, '0')}`;
            document.getElementById('resultTotalTime').textContent = Math.ceil(totalRequiredTime);
            document.getElementById('resultRunTime').textContent = Math.ceil(totalRunTime);

            const judgeEl = document.getElementById('judgeResult');
            const detailEl = document.getElementById('judgeDetail');
            const diff = totalWorkTime - totalRequiredTime;
            if (diff >= 0) { judgeEl.textContent = "OK"; judgeEl.style.color = "var(--success)"; detailEl.textContent = `å®šæ™‚å†…ã«å®Œäº† (ä½™è£• ${Math.floor(diff)}åˆ†)`; }
            else { judgeEl.textContent = "æ®‹æ¥­"; judgeEl.style.color = "var(--danger)"; detailEl.textContent = `${Math.abs(Math.floor(diff))} åˆ†ã®è¶…é`; }

            document.getElementById('detailMode').textContent = currentMode === '2E' ? '2E (å›ºå®š)' : 'æ··è¼‰';
            document.getElementById('detailTotalQty').textContent = totalQty.toLocaleString();
            const pph = totalWorkTime > 0 ? (totalQty / (totalWorkTime / 60)) : 0;
            document.getElementById('detailPPH').textContent = Math.round(pph).toLocaleString() + " å€‹/h";

            // è¨­å‚™èƒ½åŠ›ï¼ˆã‚¹ãƒšãƒƒã‚¯å€¤ï¼‰
            const specPPM = currentMode === '2E' ? SPECS['2E'].speed : 0;
            document.getElementById('detailSpecPPM').textContent = specPPM + " å€‹/åˆ†";

            // å®ŸåŠ¹PPMï¼ˆå®Ÿéš›ã®ç”Ÿç”£æ€§ï¼‰
            const effectivePPM = totalWorkTime > 0 ? (totalQty / totalWorkTime) : 0;
            document.getElementById('detailEffectivePPM').textContent = effectivePPM.toFixed(1) + " å€‹/åˆ†";

            // è¨­å‚™ç¨¼åƒåŠ¹ç‡ï¼ˆå®ŸåŠ¹PPM Ã· è¨­å‚™èƒ½åŠ› Ã— 100ï¼‰
            const efficiency = specPPM > 0 ? (effectivePPM / specPPM * 100) : 0;
            document.getElementById('detailEfficiency').textContent = efficiency.toFixed(1) + " %";

            const availability = totalWorkTime > 0 ? (totalRunTime / totalWorkTime * 100) : 0;
            document.getElementById('detailAvailability').textContent = availability.toFixed(1) + " %";

            let breakTimeTotal = 0;
            finalEvents.forEach(e => { if (e.color === 'bg-break') breakTimeTotal += e.duration; });

            let lossSum = 0;
            if (document.getElementById('checkSetup').checked) lossSum += (parseFloat(document.getElementById('setupTime').value) || 0);
            if (document.getElementById('checkShutdown').checked) lossSum += (parseFloat(document.getElementById('shutdownTime').value) || 0);
            if (document.getElementById('checkTopTape').checked) lossSum += 15;
            if (document.getElementById('checkCarrierTape').checked) lossSum += 15;
            lossSum += totalTypeChangeTime + totalReelSwitchTime + totalLotSwitchTime + breakTimeTotal;
            document.getElementById('detailLoss').textContent = Math.ceil(lossSum);

            let breakdownData = {};
            breakdownData['è¨­å‚™ç«‹ã¡ä¸Šã’'] = document.getElementById('checkSetup').checked ? (parseFloat(document.getElementById('setupTime').value) || 0) : 0;
            breakdownData['è¨­å‚™ç«‹ã¡ä¸‹ã’'] = document.getElementById('checkShutdown').checked ? (parseFloat(document.getElementById('shutdownTime').value) || 0) : 0;
            breakdownData['ãƒˆãƒƒãƒ—ãƒ†ãƒ¼ãƒ—äº¤æ›'] = document.getElementById('checkTopTape').checked ? 15 : 0;
            breakdownData['ã‚­ãƒ£ãƒªã‚¢ãƒ†ãƒ¼ãƒ—äº¤æ›'] = document.getElementById('checkCarrierTape').checked ? 15 : 0;
            breakdownData['å“ç¨®åˆ‡æ›¿'] = totalTypeChangeTime;
            breakdownData['ãƒªãƒ¼ãƒ«äº¤æ›'] = totalReelSwitchTime;
            breakdownData['Lotåˆ‡æ›¿'] = totalLotSwitchTime;
            breakdownData['ä¼‘æ†©'] = breakTimeTotal;

            let filteredBreakdown = {};
            for (let k in breakdownData) { if (breakdownData[k] > 0) filteredBreakdown[k] = breakdownData[k]; }

            drawBreakdownTable(filteredBreakdown, totalWorkTime, lossSum);
            drawTimeline(finalEvents, startTimeMin, endTimeMin);
            drawScheduleList(finalEvents);
        }

        function drawBreakdownTable(data, workTime, totalLoss) {
            const tbody = document.getElementById('breakdownBody');
            tbody.innerHTML = '';
            for (const [name, time] of Object.entries(data)) {
                const ratioWork = workTime > 0 ? (time / workTime * 100).toFixed(1) : '0.0';
                const ratioLoss = totalLoss > 0 ? (time / totalLoss * 100).toFixed(1) : '0.0';
                const tr = document.createElement('tr');
                tr.innerHTML = `<td>-</td><td>${name}</td><td style="text-align: right;">${Math.round(time)} åˆ†</td><td style="text-align: right;">${ratioWork} %</td><td style="text-align: right;">${ratioLoss} %</td>`;
                tbody.appendChild(tr);
            }
            const trTotal = document.createElement('tr');
            trTotal.innerHTML = `<td colspan="2">åˆè¨ˆ</td><td style="text-align: right;">${Math.round(totalLoss)} åˆ†</td><td style="text-align: right;">${workTime > 0 ? (totalLoss / workTime * 100).toFixed(1) : 0} %</td><td style="text-align: right;">100.0 %</td>`;
            tbody.appendChild(trTotal);
        }

        function drawTimeline(events, start, end) {
            const scaleContainer = document.getElementById('timelineScale');
            const barsContainer = document.getElementById('timelineBars');
            scaleContainer.innerHTML = '';
            barsContainer.innerHTML = '';

            const viewStartTime = Math.floor(start / 60) * 60;
            const duration = end - viewStartTime;

            // Auto-scale: Calculate pxPerMin based on container width
            const containerWidth = scaleContainer.parentElement.clientWidth - 20;
            const pxPerMin = Math.max(0.5, containerWidth / duration);

            barsContainer.style.width = `${containerWidth}px`;
            scaleContainer.style.width = `${containerWidth}px`;

            const startHour = Math.floor(viewStartTime / 60);
            const endHour = Math.ceil(end / 60);

            for (let h = startHour; h <= endHour; h++) {
                const min = h * 60;
                const pos = (min - viewStartTime) * pxPerMin;
                const el = document.createElement('div');
                el.className = 'scale-hour';
                el.style.position = 'absolute';
                el.style.left = `${pos}px`;
                el.textContent = `${h}:00`;
                scaleContainer.appendChild(el);
            }

            events.forEach(evt => {
                const pos = (evt.start - viewStartTime) * pxPerMin;
                const width = evt.duration * pxPerMin;
                const el = document.createElement('div');
                el.className = `tl-event ${evt.color}`;
                el.style.left = `${pos}px`;
                el.style.width = `${width}px`;
                el.title = `${evt.name}: ${Math.round(evt.duration)}åˆ†`;
                barsContainer.appendChild(el);
            });
        }

        function drawScheduleList(events) {
            const tbody = document.getElementById('scheduleListBody');
            tbody.innerHTML = '';
            events.forEach(evt => {
                const startH = Math.floor(evt.start / 60) % 24;
                const startM = Math.floor(evt.start % 60);
                const endMin = evt.start + evt.duration;
                const endH = Math.floor(endMin / 60) % 24;
                const endM = Math.floor(endMin % 60);
                const timeStr = (h, m) => `${String(h).padStart(2, '0')}:${String(m).padStart(2, '0')}`;
                const tr = document.createElement('tr');
                tr.innerHTML = `<td>${timeStr(startH, startM)}</td><td>${timeStr(endH, endM)}</td><td>${evt.name}</td><td style="text-align: right;">${Math.round(evt.duration)} åˆ†</td>`;
                tbody.appendChild(tr);
            });
        }
        function togglePrintPreview() {
            document.body.classList.toggle('print-preview-mode');
            if (document.body.classList.contains('print-preview-mode')) {
                window.scrollTo(0, 0);
            }
        }

        init();
    </script>
</body>

</html>